<!DOCTYPE html><html class="default no-js"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>Falkor Operations Library - v1.0.0-beta.2</title><meta name="description" content="Documentation for Falkor Operations Library - v1.0.0-beta.2"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem(&quot;tsd-theme&quot;) || &quot;os&quot;)</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">Falkor Operations Library - v1.0.0-beta.2</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>Falkor Operations Library - v1.0.0-beta.2</h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography">
<a href="#falkor-operations-library" id="falkor-operations-library" style="color: inherit; text-decoration: none;">
  <h1><strong>Falkor Operations Library</strong></h1>
</a>
<p><a href="https://www.npmjs.com/package/@falkor/falkor-library" title="Visit"><img src="https://img.shields.io/github/package-json/keywords/theonethread/falkor-library" alt="Npm Keywords" title="Keywords"></a> &nbsp;
<a href="https://www.npmjs.com/package/@falkor/falkor-library" title="Visit"><img src="https://img.shields.io/npm/v/@falkor/falkor-library" alt="Npm Package" title="Npm"></a> &nbsp;
<a href="https://nodejs.org/" title="Visit"><img src="https://img.shields.io/node/v/@falkor/falkor-library" alt="Node Version" title="Node"></a> &nbsp;
<a href="https://github.com/theonethread/falkor-library/actions" title="Visit"><img src="https://img.shields.io/github/workflow/status/theonethread/falkor-library/Falkor%20CI%20-%20Manual" alt="CI" title="CI"></a> &nbsp;
<a href="https://github.com/theonethread/falkor-library" title="Visit"><img src="https://img.shields.io/github/last-commit/theonethread/falkor-library" alt="Activity" title="Activity"></a> &nbsp;
<a href="https://www.npmjs.com/package/@falkor/falkor-bundler" title="Visit"><img src="https://img.shields.io/npm/dependency-version/@falkor/falkor-library/dev/@falkor/falkor-bundler" alt="Falkor Bundler" title="Falkor Bundler"></a> &nbsp;
<a href="https://www.typescriptlang.org/" title="Visit"><img src="https://img.shields.io/npm/types/@falkor/falkor-library" alt="Type Definitions" title="Typings"></a> &nbsp;
<a href="https://snyk.io/test/github/theonethread/falkor-library" title="Visit"><img src="https://img.shields.io/snyk/vulnerabilities/github/theonethread/falkor-library" alt="Snyk Vulnerabilities" title="Snyk"></a> &nbsp;
<a href="https://github.com/theonethread/falkor-library/blob/master/license.txt" title="Visit"><img src="https://img.shields.io/npm/l/@falkor/falkor-library" alt="License" title="MIT"></a></p>
<pre><code class="language-javascript"><span class="hl-0">// Work In Progress</span>
</code></pre>
<p>The <code>falkor-library</code> project is a collection of DevOps tools written in strict ES6 TypeScript to be used with the <strong>Falkor Framework</strong>.</p>

<a href="#usage" id="usage" style="color: inherit; text-decoration: none;">
  <h2><strong>Usage</strong></h2>
</a>
<pre><code class="language-typescript"><span class="hl-1">import</span><span class="hl-2"> </span><span class="hl-3">falkor</span><span class="hl-2"> </span><span class="hl-1">from</span><span class="hl-2"> </span><span class="hl-4">&quot;@falkor/falkor-library&quot;</span><span class="hl-2">;</span><br/><br/><span class="hl-0">// extend Task</span><br/><span class="hl-5">class</span><span class="hl-2"> </span><span class="hl-6">ExampleTask</span><span class="hl-2"> </span><span class="hl-5">extends</span><span class="hl-2"> </span><span class="hl-6">falkor</span><span class="hl-2">.</span><span class="hl-6">Task</span><span class="hl-2"> {</span><br/><span class="hl-2">    </span><span class="hl-5">constructor</span><span class="hl-2">() {</span><br/><span class="hl-2">        </span><span class="hl-5">super</span><span class="hl-2">(</span><br/><span class="hl-2">            </span><span class="hl-0">// name of the current sequence batch</span><br/><span class="hl-2">            </span><span class="hl-4">&quot;Task Example&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-0">// *optional* global command-line dependencies</span><br/><span class="hl-2">            {</span><br/><span class="hl-2">                </span><span class="hl-0">// lazy shorthand syntax</span><br/><span class="hl-2">                </span><span class="hl-3">git:</span><span class="hl-2"> </span><span class="hl-4">&quot;2.30.1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                </span><span class="hl-0">// below dependency object is the equivalent of &quot;11.0.1&quot; (lazy shorthand syntax string, like above)</span><br/><span class="hl-2">                </span><span class="hl-0">// this is *exactly* how the library unfolds shorthand dependencies</span><br/><span class="hl-2">                </span><span class="hl-0">// @see TaskRunner::mergeDependencies</span><br/><span class="hl-2">                </span><span class="hl-4">&quot;clang++&quot;</span><span class="hl-3">:</span><span class="hl-2"> {</span><br/><span class="hl-2">                    </span><span class="hl-3">command:</span><span class="hl-2"> </span><span class="hl-4">&quot;clang++ --version&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                    </span><span class="hl-3">minVersion:</span><span class="hl-2"> </span><span class="hl-4">&quot;11.0.1&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">                    </span><span class="hl-3">versionMatch:</span><span class="hl-7"> /version\s</span><span class="hl-8">*</span><span class="hl-9">([^</span><span class="hl-7">\s</span><span class="hl-9">]</span><span class="hl-8">+</span><span class="hl-9">)</span><span class="hl-7">/</span><br/><span class="hl-2">                }</span><br/><span class="hl-2">            }</span><br/><span class="hl-2">        );</span><br/><span class="hl-2">    }</span><br/><br/><span class="hl-2">    </span><span class="hl-0">// necessary implementation of abstract async function (entry point)</span><br/><span class="hl-2">    </span><span class="hl-5">public</span><span class="hl-2"> </span><span class="hl-5">async</span><span class="hl-2"> </span><span class="hl-10">run</span><span class="hl-2">(): </span><span class="hl-6">Promise</span><span class="hl-2">&lt;</span><span class="hl-6">void</span><span class="hl-2">&gt; {</span><br/><span class="hl-2">        </span><span class="hl-0">// asynchronous command-line execution</span><br/><span class="hl-2">        </span><span class="hl-0">// (command output is handled by library)</span><br/><span class="hl-2">        </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-11">fetchResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">exec</span><span class="hl-2">(</span><span class="hl-4">&quot;git fetch --all --tags&quot;</span><span class="hl-2"> </span><span class="hl-0">/*+ &quot; --recurse-submodules&quot; /**/</span><span class="hl-2">, {</span><br/><span class="hl-2">            </span><span class="hl-0">// current working directory for command</span><br/><span class="hl-2">            </span><span class="hl-3">cwd:</span><span class="hl-2"> </span><span class="hl-4">&quot;../falkor-library&quot;</span><br/><span class="hl-2">        });</span><br/><span class="hl-2">        </span><span class="hl-0">// the library does not throw errors (apart in setup stage), once running it only reports failure(s)</span><br/><span class="hl-2">        </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">fetchResult</span><span class="hl-2">.</span><span class="hl-3">success</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-0">// built in method, that *throws* library acceptable error</span><br/><span class="hl-2">            </span><span class="hl-0">// (reducing state to PANIC, allowing task level clean-up, then exiting with non-zero exit code)</span><br/><span class="hl-2">            </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">error</span><span class="hl-2">(</span><span class="hl-4">&quot;failed fetch&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">        }</span><br/><br/><span class="hl-2">        </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-11">commitResult</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">exec</span><span class="hl-2">(</span><span class="hl-4">&quot;git commit&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">            </span><span class="hl-3">cwd:</span><span class="hl-2"> </span><span class="hl-4">&quot;../falkor-library&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-0">// exceptions are silenced, when output is tested positive for any of these *optional* regular expressions</span><br/><span class="hl-2">            </span><span class="hl-3">noError:</span><span class="hl-2"> [</span><span class="hl-7">/nothing to commit, working tree clean/</span><span class="hl-2">]</span><br/><span class="hl-2">        });</span><br/><span class="hl-2">        </span><span class="hl-1">if</span><span class="hl-2"> (!</span><span class="hl-3">commitResult</span><span class="hl-2">.</span><span class="hl-3">success</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">error</span><span class="hl-2">(</span><span class="hl-4">&quot;failed commit&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">        }</span><br/><br/><span class="hl-2">        </span><span class="hl-0">// request input from the user</span><br/><span class="hl-2">        </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-11">answer1</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">ask</span><span class="hl-2">(</span><br/><span class="hl-2">            </span><span class="hl-0">// the text of the &quot;question&quot; is necessary</span><br/><span class="hl-2">            </span><span class="hl-4">&quot;try selection:&quot;</span><span class="hl-2">,</span><br/><span class="hl-2">            {</span><br/><span class="hl-2">                </span><span class="hl-0">// if answers are provided, the input will be tested against them</span><br/><span class="hl-2">                </span><span class="hl-3">answers:</span><span class="hl-2"> [</span><span class="hl-4">&quot;node&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;python&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;erlang&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;go&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;php&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;lisp&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;fortran&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">                </span><span class="hl-0">// forces answer items to be displayed line-by-line</span><br/><span class="hl-2">                </span><span class="hl-0">// (this also makes them selectable by answer number, or interactively)</span><br/><span class="hl-2">                </span><span class="hl-3">list:</span><span class="hl-2"> </span><span class="hl-5">true</span><br/><span class="hl-2">            }</span><br/><span class="hl-2">        );</span><br/><span class="hl-2">        </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">answer1</span><span class="hl-2"> === </span><span class="hl-5">null</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-0">// currently this can only happen after predefined number of wrong answers, or after timeout</span><br/><span class="hl-2">            </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">error</span><span class="hl-2">(</span><span class="hl-4">&quot;failed input&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">        }</span><br/><br/><span class="hl-2">        </span><span class="hl-0">// allows multiple selection (separated by commas, or by interactive input)</span><br/><span class="hl-2">        </span><span class="hl-5">const</span><span class="hl-2"> </span><span class="hl-11">answer2</span><span class="hl-2"> = </span><span class="hl-1">await</span><span class="hl-2"> </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">ask</span><span class="hl-2">(</span><span class="hl-4">&quot;try multi-selection:&quot;</span><span class="hl-2">, {</span><br/><span class="hl-2">            </span><span class="hl-0">// if answers are provided, the input will be tested against them</span><br/><span class="hl-2">            </span><span class="hl-3">answers:</span><span class="hl-2"> [</span><span class="hl-4">&quot;node&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;python&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;erlang&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;go&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;php&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;lisp&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;fortran&quot;</span><span class="hl-2">],</span><br/><span class="hl-2">            </span><span class="hl-0">// forces answer items to be displayed line-by-line</span><br/><span class="hl-2">            </span><span class="hl-0">// (this also makes them selectable by answer number-, or interactively)</span><br/><span class="hl-2">            </span><span class="hl-3">list:</span><span class="hl-2"> </span><span class="hl-5">true</span><span class="hl-2">,</span><br/><span class="hl-2">            </span><span class="hl-0">// if answers are provided, this will allow multiple selection</span><br/><span class="hl-2">            </span><span class="hl-0">// (with- or without list mode)</span><br/><span class="hl-2">            </span><span class="hl-3">multi:</span><span class="hl-2"> </span><span class="hl-5">true</span><br/><span class="hl-2">        });</span><br/><span class="hl-2">        </span><span class="hl-1">if</span><span class="hl-2"> (</span><span class="hl-3">answer2</span><span class="hl-2"> === </span><span class="hl-5">null</span><span class="hl-2">) {</span><br/><span class="hl-2">            </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-10">error</span><span class="hl-2">(</span><span class="hl-4">&quot;failed input&quot;</span><span class="hl-2">);</span><br/><span class="hl-2">        }</span><br/><br/><span class="hl-2">        </span><span class="hl-0">// the logger instance is used to display formatted data throughout the batch</span><br/><span class="hl-2">        </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-3">logger</span><br/><span class="hl-2">            </span><span class="hl-0">// new prompt for all further logs, newlines in logs will be indented with same length whitespace</span><br/><span class="hl-2">            .</span><span class="hl-10">pushPrompt</span><span class="hl-2">(</span><span class="hl-4">&quot;[NIRVANA]&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">            </span><span class="hl-0">// level of output is based on configuration, one can use:</span><br/><span class="hl-2">            </span><span class="hl-0">// debug(), notice(), info(), warning(), error(), fatal()</span><br/><span class="hl-2">            </span><span class="hl-0">// @see LogLevel</span><br/><span class="hl-2">            .</span><span class="hl-10">info</span><span class="hl-2">(</span><span class="hl-4">&quot;luv&#39; this band&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">            </span><span class="hl-0">// prompts also support internal ansi color sequence(s) - if underlying terminal does too</span><br/><span class="hl-2">            .</span><span class="hl-10">pushPrompt</span><span class="hl-2">(</span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-3">theme</span><span class="hl-2">.</span><span class="hl-10">formatTrace</span><span class="hl-2">(</span><span class="hl-4">&quot;nevermind&quot;</span><span class="hl-2">))</span><br/><span class="hl-2">            </span><span class="hl-0">// (level of output can be overridden in the &#39;.ops.json&#39; file in project root)</span><br/><span class="hl-2">            </span><span class="hl-0">// @see LogLevel</span><br/><span class="hl-2">            .</span><span class="hl-10">info</span><span class="hl-2">(</span><br/><span class="hl-2">                </span><span class="hl-0">// inline styling of log chunks is always done through the theme</span><br/><span class="hl-2">                </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-3">theme</span><span class="hl-2">.</span><span class="hl-10">formatSuccess</span><span class="hl-2">(</span><br/><span class="hl-2">                    </span><span class="hl-0">// ascii is a new addition, currently it creates lists, and ascii figlet fonts</span><br/><span class="hl-2">                    </span><span class="hl-0">// (newlines are padded correctly by library, extra one added to the end for readability)</span><br/><span class="hl-2">                    </span><span class="hl-5">this</span><span class="hl-2">.</span><span class="hl-3">ascii</span><span class="hl-2">.</span><span class="hl-10">font</span><span class="hl-2">(</span><span class="hl-4">&quot;I&#39;m done&quot;</span><span class="hl-2">, </span><span class="hl-4">&quot;Big&quot;</span><span class="hl-2">)</span><br/><span class="hl-2">                )</span><br/><span class="hl-2">            )</span><br/><span class="hl-2">            </span><span class="hl-0">// discard the last two demonstrational prompts</span><br/><span class="hl-2">            .</span><span class="hl-10">popPrompt</span><span class="hl-2">(</span><span class="hl-12">2</span><span class="hl-2">);</span><br/><span class="hl-2">    }</span><br/><span class="hl-2">}</span>
</code></pre>

<a href="#further-development" id="further-development" style="color: inherit; text-decoration: none;">
  <h2><strong>Further Development</strong></h2>
</a>
<p>The project uses the <a href="https://www.npmjs.com/package/@falkor/falkor-bundler" title="Visit"><code>@falkor/falkor-bundler</code></a> module to compile sources. You can run:</p>
<pre><code><span class="hl-3">$</span><span class="hl-2"> </span><span class="hl-3">npm</span><span class="hl-2"> </span><span class="hl-3">run</span><span class="hl-2"> [ </span><span class="hl-3">debug</span><span class="hl-2"> | </span><span class="hl-3">release</span><span class="hl-2"> ]</span>
</code></pre>
<blockquote>
<p><em><strong>SEE</strong>: <code>&quot;scripts&quot;</code> entry in <a href="https://github.com/theonethread/falkor-library/blob/master/package.json" title="Open"><code>package.json</code></a></em></p>
</blockquote>

<a href="#documentation" id="documentation" style="color: inherit; text-decoration: none;">
  <h3><strong>Documentation</strong></h3>
</a>
<p>To generate HTML documentation from the TypeScript sources under the ignored <code>.doc</code> directory using <a href="https://typedoc.org" title="Visit">Typedoc</a> run:</p>
<pre><code><span class="hl-3">$</span><span class="hl-2"> </span><span class="hl-3">npm</span><span class="hl-2"> </span><span class="hl-3">run</span><span class="hl-2"> </span><span class="hl-3">doc</span>
</code></pre>
<p>Or you can visit the exported <a href="https://theonethread.github.io/falkor-library-doc" title="Visit">online documentation</a>.</p>

<a href="#todo" id="todo" style="color: inherit; text-decoration: none;">
  <h3><strong>TODO</strong></h3>
</a>
<ul>
<li>Extend error handling with signals:<ul>
<li>Recognize need of recovery on <code>SIGINT</code></li>
</ul>
</li>
<li>Run failure log based recovery at startup, rather than secure graceful shutdown on error / signal<ul>
<li>Fewer plugins to load in <code>recovery</code> mode, if explicitly requested</li>
</ul>
</li>
</ul>

<a href="#version-history" id="version-history" style="color: inherit; text-decoration: none;">
  <h3><strong>Version History</strong></h3>
</a>
<ul>
<li><code>development</code><ul>
<li><a href="https://github.com/theonethread/falkor-library" title="Visit">GitHub</a></li>
</ul>
</li>
<li><code>1.0.0-beta.2</code><ul>
<li><a href="https://www.npmjs.com/package/@falkor/falkor-library/v/1.0.0-beta.2" title="Visit">npmjs</a></li>
<li><a href="https://github.com/theonethread/falkor-library/releases/tag/v1.0.0-beta.2" title="Visit">GitHub</a></li>
</ul>
</li>
<li><code>1.0.0-beta.1</code><ul>
<li><a href="https://www.npmjs.com/package/@falkor/falkor-library/v/1.0.0-beta.1" title="Visit">npmjs</a></li>
<li><a href="https://github.com/theonethread/falkor-library/releases/tag/v1.0.0-beta.1" title="Visit">GitHub</a></li>
</ul>
</li>
<li><code>1.0.0-beta.0</code><ul>
<li><a href="https://www.npmjs.com/package/@falkor/falkor-library/v/1.0.0-beta.0" title="Visit">npmjs</a></li>
<li><a href="https://github.com/theonethread/falkor-library/releases/tag/v1.0.0-beta.0" title="Visit">GitHub</a></li>
</ul>
</li>
</ul>

<a href="#open-source" id="open-source" style="color: inherit; text-decoration: none;">
  <h3><strong>Open Source</strong></h3>
</a>
<p>You can always find the latest sources on <a href="https://github.com/theonethread/falkor-library" title="Visit">GitHub</a>.</p>

<a href="#license" id="license" style="color: inherit; text-decoration: none;">
  <h3><strong>License</strong></h3>
</a>
<p><a href="https://github.com/theonethread/falkor-library/blob/master/license.txt" title="Open">MIT</a></p>
<p><em>©2020-2021 Barnabas Bucsy - All rights reserved.</em></p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li><li class=" tsd-kind-namespace"><a href="modules/_falkor.html">@falkor</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-property"><a href="modules.html#default" class="tsd-kind-icon">default</a></li></ul></nav></div></div></div><footer class=""><div class="container"><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="overlay"></div><script src="assets/main.js"></script></body></html>